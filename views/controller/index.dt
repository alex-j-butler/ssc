extends controller/layout.dt

block head
    title Servers

block content
    script.
        function updateServers() {
            get('/controller/servers_table?key=#{key}', function(response) {
                var container = document.getElementById('servers');
                container.innerHTML = response;
            });
        }

        updateServers();
        setInterval(updateServers, 2000);

        function updateBookings() {
            get('/controller/bookings_table?key=#{key}', function(response) {
                var container = document.getElementById('bookings');
                container.innerHTML = response;
            });
        }

        updateBookings();
        setInterval(updateBookings, 2000);

    - import std.string;
    - string url;

    h1 Source Server Controller

    .panel.panel-info
        .panel-heading Servers
        table#servers.table.table-striped

    .panel.panel-info
        .panel-heading Bookings
        table#bookings.table.table-striped

        hr

        .panel-body
            h3 Create Booking
            - url = "/controller/bookings?key=%s".format(key);
            form(role="form", action=url, method="post")
                .row
                    .col-md-6
                        input.form-control(type="text", name="user", placeholder="user")
                    .col-md-5
                        input.form-control(type="number", name="duration", placeholder="duration (hours)")
                    .col-md-1
                        input.btn.btn-default(type="submit", value="Create")

    .panel.panel-danger
        .panel-heading Control
        .panel-body
            - url = "/controller/dirty_servers?key=%s".format(key);
            form(role="form", action=url, method="post")
                input.btn.btn-default(type="submit", value="Mark Servers Dirty")

            - url = "/controller/reload_servers?key=%s".format(key);
            form(role="form", action=url, method="post")
                input.btn.btn-default(type="submit", value="Reload Server Configuration")

            - url = "/controller/restart_servers?key=%s".format(key);
            form(role="form", action=url, method="post")
                input.btn.btn-default(type="submit", value="Restart All Servers!")
